<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->

<head>
    <meta charset="utf-8" />
    <title>{% block title %}ansible平台{% endblock %}</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="" name="description" />
    <meta content="" name="author" />
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="/static/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
    <link href="/static/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="/static/css/style-metro.css" rel="stylesheet" type="text/css" />
    <link href="/static/css/style.css" rel="stylesheet" type="text/css" />
    <link href="/static/css/style-responsive.css" rel="stylesheet" type="text/css" />
    <link href="/static/css/default.css" rel="stylesheet" type="text/css" id="style_color" />
    <link href="/static/css/uniform.default.css" rel="stylesheet" type="text/css" />
    <!-- mask alert -->
    <link href="/static/css/jquery-ui-1.10.1.custom.min.css" rel="stylesheet" type="text/css" />
    <link href="/static/css/bootstrap-modal.css" rel="stylesheet" type="text/css" />
    <!-- mask alert -->
    <!-- END GLOBAL MANDATORY STYLES -->
    <link rel="shortcut icon" href="/static/image/favicon.png" />
    <!-- END COPYRIGHT -->
    <!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
    <!-- BEGIN CORE PLUGINS -->
    <script src="/static/js/jquery-1.10.1.min.js" type="text/javascript"></script>
    <script src="/static/js/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>
    <!-- IMPORTANT! Load jquery-ui-1.10.1.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
    <script src="/static/js/jquery-ui-1.10.1.custom.min.js" type="text/javascript"></script>
	<script src="/static/js/jquery.cookie.min.js" type="text/javascript"></script>
    <script src="/static/js/bootstrap.min.js" type="text/javascript"></script>
    <!--[if lt IE 9]>

    <script src="/static/js/excanvas.min.js"></script>

    <script src="/static/js/respond.min.js"></script>  

    <![endif]-->
    <script src="/static/js/jquery.slimscroll.min.js" type="text/javascript"></script>
    <script src="/static/js/jquery.blockui.min.js" type="text/javascript"></script>
    <script src="/static/js/jquery.cookie.min.js" type="text/javascript"></script>
    <script src="/static/js/jquery.uniform.min.js" type="text/javascript"></script>
    <!-- END CORE PLUGINS -->
    <!-- BEGIN PAGE LEVEL PLUGINS -->
    <script src="/static/js/jquery.validate.min.js" type="text/javascript"></script>
    <script src="/static/js/jquery.backstretch.min.js" type="text/javascript"></script>
    <!-- END PAGE LEVEL PLUGINS -->
    <!-- BEGIN PAGE LEVEL SCRIPTS -->
    <script src="/static/js/app.js" type="text/javascript"></script>
    <!-- END PAGE LEVEL SCRIPTS -->
    <script src="/static/js/bootstrap-modal.js" type="text/javascript"></script>
    <script src="/static/js/bootstrap-modalmanager.js" type="text/javascript"></script>
    <script src="/static/js/ui-modals.js"></script>
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->
<style>
.setbg input[type="text"],
.setcol .yu_bgcol {
    background-color: initial!important;
}
</style>

<body class="page-header-fixed">
    <!-- BEGIN HEADER -->
    <div class="header navbar navbar-inverse navbar-fixed-top">
        <!-- BEGIN TOP NAVIGATION BAR -->
        <div class="navbar-inner">
            <div class="container-fluid">
                <!-- BEGIN LOGO -->
                <a class="brand" href="/">
                    <img src="/static/image/logo.png" alt="logo" />
                </a>
                <!-- END LOGO -->
                <!-- BEGIN RESPONSIVE MENU TOGGLER -->
                <a href="javascript:;" class="btn-navbar collapsed" data-toggle="collapse" data-target=".nav-collapse">
                    <img src="/static/image/menu-toggler.png" alt="" />
                </a>
                <!-- END RESPONSIVE MENU TOGGLER -->
                <!-- BEGIN TOP NAVIGATION MENU 右上角 用户登录相关-->
                <ul class="nav pull-right">
				<p><a style="color:white; font-size:18px;" href="/logout/">注销</a></p>
                </ul>
                <!-- END TOP NAVIGATION MENU -->
            </div>
        </div>
        <!-- END TOP NAVIGATION BAR -->
    </div>
    <!-- End HEADER -->
    <!-- BEGIN CONTAINER -->
    <div class="page-container row-fluid">
        <!-- BEGIN SIDEBAR -->
        <div class="page-sidebar nav-collapse collapse">
            <!-- Begin SIDEBAR MENU -->
            <!-- BEGIN SIDEBAR MENU -->
            <ul class="page-sidebar-menu">
                <li>
                    <!-- BEGIN SIDEBAR TOGGLER BUTTON -->
                    <div class="sidebar-toggler hidden-phone"></div>
                    <!-- BEGIN SIDEBAR TOGGLER BUTTON -->
                </li>
                <li>
                    <a href="javascript:;">
                        <i class="icon-file"></i>
                        <span class="title">文件管理</span>
                        <span class="arrow "></span>
                    </a>
                    <ul class="sub-menu">
                        <li>
                            <a href="/file/">新建/删除</a>
                            <a href="/copy/">文件分发</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="/shell/">
                        <i class=" icon-font"></i>
                        <span class="title">执行命令</span>
                    </a>
                </li>
				<li>
                    <a href="/service/">
                        <i class="icon-glass"></i>
                        <span class="title">服务管理</span>
                    </a>
                </li>
				<li>
                    <a href="/software/">
                        <i class="icon-inbox"></i>
                        <span class="title">软件管理</span>
                    </a>
                </li>				
				<li>
                    <a href="/onekey/">
                        <i class="icon-cogs"></i>
                        <span class="title">一键部署</span>
                    </a>
                </li>
                <li>
                    <a href="javascript:;">
                        <i class="icon-wrench"></i>
                        <span class="title">节点管理</span>
                        <span class="arrow "></span>
                    </a>
                    <ul class="sub-menu">
                        <li>
                            <a href="/group/">分组管理</a>
                            <a href="/host/">主机管理</a>
                        </li>
                    </ul>
                </li>
			</ul>
            <!-- END SIDEBAR MENU -->
        </div>
        <!-- END SIDEBAR -->
        <!-- BEGIN PAGE -->
        <div class="page-content">            
            <div class="container-fluid">
                <!-- BEGIN PAGE HEADER-->
                <div class="row-fluid">
                    <div class="span12">
                        <!-- BEGIN PAGE TITLE & BREADCRUMB-->
                        <h3 class="page-title">
							{% block content_title %}
							ansible平台
							{% endblock %}
							<small></small>
                        </h3>
                        <!-- END PAGE TITLE & BREADCRUMB-->
                    </div>
                </div>
                <!-- END PAGE HEADER-->
                <!-- Begin result-->
                <div>
					{% block content %}{% endblock %}
				</div>
                <!-- END result-->
            </div>
            <!-- END PAGE CONTAINER-->
        </div>
        <!-- end PAGE -->
        <!-- **** -->
        <!-- **** -->
    </div>
    <!-- END CONTAINER -->
    <script>
    jQuery(document).ready(function() {
        App.init();
        UIModals.init();
        // var swiper = new Swiper('.swiper-container');
        $('.datainfo .span12,.loading').hide();
    });
	
    function keepdomafter() {
        play();

        $('.loading').hide();
        $('.ui-resizable-se').nextAll().remove();
        var swiper = new Swiper('.swiper-container', {
            // pagination: '.swiper-pagination',
            // paginationClickable: true,
            // nextButton: '.swiper-button-next',
            // prevButton: '.swiper-button-prev',
            // spaceBetween: 30,
            // effect: 'fade',
            // grabCursor: true,
            // autoplay: 2000,
        });
    }

//crontab切换动作
    function content(){
		var a=document.getElementById("action").value;
		if (a=="delete"){
			b=document.getElementById("content");
			b.setAttribute("hidden", true);
		}
		else{
			b=document.getElementById("content");
			b.removeAttribute("hidden", true);
		}
	}

//添加任务
	function taskadd(){
		var task=document.getElementById("task").value
		var group=document.getElementById("group").value
		var file=document.getElementById("file").value
		
		if(task==""){
			alert("请输入任务描述！")
			return false;
		}
		else if(group==""){
			alert("请选择组别!")
			return false;
		}
		else if(file==""){
			alert("请输入项目文件!")
			return false;
		}
		else{
			$("#add").append('<tr id="state" class="active"><td><button type="button" class="close" onclick="javascript:$(this).parent().parent().remove()">×</button></td><td>'+task+'</td><td>'+group+'</td><td>'+file+'</td><td class="active" id="status">待部署</td><td><a href="#myModal" class="btn-link" data-toggle="modal" onclick="return getcmd()">查看</a></td><td><button class="chkrun" id="0" onclick="return runcmd()">部署</button></td></tr>')
		}
	}

//执行任务
	function runcmd(){
		var task=document.getElementById("task").value
		var group=document.getElementById("group").value
		var file=document.getElementById("file").value
		var id=$(".chkrun").attr("id")	//检查是否重复部署
// 		var status=document.getElementById("status").innerText
// 		var url="/getcmd/"+task+"/"
		
		if(id=="0"){
			var action=confirm("开始部署!")
			if(action==true){
				document.getElementById("status").innerText="部署中";	//更改部署状态
				$("#state").attr("class", "warning");	//更改部署状态对应的颜色
				$.ajax({
					url: "/runcmd/",
					type: "post",
					data: {"task":task, "group":group, "file":file},
					headers:{ "X-CSRFtoken":$.cookie("csrftoken")},
					success: function(status){
						if(status=="ok"){
		// 					console.log(status);
							document.getElementById("status").innerText="已部署";	//更改部署状态
							alert("部署完成!");
							$(".chkrun").attr("id","1");	//部署成功后状态改为1
							$("#state").attr("class", "success");	//部署成功后的颜色
		//					$(".alert").show();
						}
						else{
							document.getElementById("status").innerText="部署失败";	//更改部署状态
							alert("部署失败!");
							$(".chkrun").attr("id","0");	//部署失败后状态改为0
							$("#state").attr("class", "danger");	//部署失败后的颜色
						}
					}
				});			
			}
			else{
				alert("取消部署!")
			}
// 		$(".log").attr("href", url);	//日志路径
		}
		else{
			alert("请勿重复部署！")
		}
	}
	
//获取命令执行结果
	function getcmd(){
		var task=document.getElementById("task").value;
		var url="/getcmd/"+task+"/"
		
		document.getElementById("myModalLabel").innerText=task;
		$.ajax({
			url: url,
			type: "post",
			headers:{ "X-CSRFtoken":$.cookie("csrftoken")},
 			success:function(result){
				console.log(result);
				document.getElementById("myModalBody").innerText=result;
 			}
		});		
	}

//删除主机
	function delhost(that){
		var name=$(that).parent().parent().attr("id");
		console.log(name)
		var action=confirm("删除主机『 "+name+" 』？");
		if(action==true){
			$.ajax({
				url: "/delhost/",
				type: "post",
				data: {"name":name},
				headers:{ "X-CSRFtoken":$.cookie("csrftoken")},
			});
			$(that).parent().parent().remove();
		}
		
	}

//删除组
	function delgroup(that){
		var name=$(that).parent().parent().attr("id");
		console.log(name)
		var action=confirm("删除组『 "+name+" 』？");
		if(action==true){
			$.ajax({
				url: "/delgroup/",
				type: "post",
				data: {"name":name},
				headers:{ "X-CSRFtoken":$.cookie("csrftoken")},
			});
			$(that).parent().parent().remove();
		}
		
	}

//检查一键部署任务描述是否重复
	function chkduplicate(){
		var check=document.getElementById("task").value
		console.log(check)
		if(check!=""){
			$.ajax({
				url:"/chkduplicate/",
				type: "post",
				data: {"check":check},
				headers:{ "X-CSRFtoken":$.cookie("csrftoken")},
				success:function(data){
					console.log(data)
					if(data=="duplicate"){
						$("#chkduplicate").show();
						$("#submit").attr("disabled", true);
					}
					else{
						$("#chkduplicate").hide();
						$("#submit").attr("disabled", false);
					}
				},
			});
		}
	}
	
    </script>
    <!-- END JAVASCRIPTS -->
</body>
<!-- END BODY -->

</html>
